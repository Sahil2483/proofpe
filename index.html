<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ProofPe - Trusted Platform</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial, sans-serif;}

body{
background:linear-gradient(135deg,#0f2a66,#1e56c4);
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.container{
width:95%;
max-width:450px;
background:white;
border-radius:25px;
padding:25px;
box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

.logo{
text-align:center;
color:white;
position:absolute;
top:30px;
left:0;
right:0;
}

.logo h1{font-size:32px;}
.logo p{opacity:0.9;}

input,select{
width:100%;
padding:14px;
margin:10px 0;
border-radius:12px;
border:1px solid #ccc;
font-size:16px;
}

button{
width:100%;
padding:14px;
margin-top:15px;
border:none;
border-radius:12px;
background:#1e56c4;
color:white;
font-size:16px;
font-weight:bold;
cursor:pointer;
}

button:hover{opacity:0.9;}

.link{
margin-top:15px;
text-align:center;
}

.link span{
color:#1e56c4;
font-weight:bold;
cursor:pointer;
}

.logout{
position:absolute;
top:15px;
right:20px;
color:white;
cursor:pointer;
font-size:14px;
text-align:center;
}

.logout span{
display:block;
font-size:12px;
}

.doc-card{
background:#f2f2f2;
padding:12px;
border-radius:12px;
margin-top:10px;
}

.doc-actions{
display:flex;
justify-content:space-between;
margin-top:8px;
}

.small-btn{
padding:6px 10px;
border:none;
border-radius:8px;
font-size:12px;
cursor:pointer;
}

.view-btn{background:#1e56c4;color:white;}
.delete-btn{background:#e74c3c;color:white;}

.hidden{display:none;}
</style>
</head>

<body>

<div class="logo">
<h1>ProofPe</h1>
<p>Trusted Platform</p>
</div>

<div class="logout hidden" id="logoutBtn">
ðŸšª
<span>Logout</span>
</div>

<div class="container">

<!-- LOGIN -->
<div id="loginDiv">
<h2>Login</h2>
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Password">
<button onclick="login()">Continue</button>
<div class="link">
Don't have account? <span onclick="showSignup()">Sign Up</span>
</div>
</div>

<!-- SIGNUP -->
<div id="signupDiv" class="hidden">
<h2>Sign Up</h2>
<input type="text" id="signupName" placeholder="Full Name">
<input type="email" id="signupEmail" placeholder="Email">
<input type="password" id="signupPassword" placeholder="Password (min 6)">
<button onclick="signup()">Create Account</button>
<div class="link">
Already have account? <span onclick="showLogin()">Sign In</span>
</div>
</div>

<!-- DASHBOARD -->
<div id="dashboardDiv" class="hidden">
<h3 id="welcomeUser"></h3>

<h3 style="margin-top:15px;">Upload Document</h3>

<select id="docType">
<option>Aadhaar Card</option>
<option>PAN Card</option>
<option>Passport</option>
<option>Driving License</option>
<option>Voter ID</option>
<option>Ration Card</option>
<option>Birth Certificate</option>
<option>10th Marksheet</option>
<option>12th Marksheet</option>
<option>Graduation Degree</option>
<option>Post Graduation Degree</option>
<option>Bank Passbook</option>
<option>Electricity Bill</option>
<option>Water Bill</option>
<option>Income Certificate</option>
<option>Caste Certificate</option>
<option>Domicile Certificate</option>
<option>Marriage Certificate</option>
<option>Property Papers</option>
<option>Vehicle RC</option>
</select>

<input type="file" id="fileInput">
<button onclick="uploadDoc()">Upload</button>

<h3 style="margin-top:20px;">My Documents</h3>
<div id="docsList"></div>

</div>
</div>

<!-- Firebase -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBy1Tg5YyNMEdDZunWONMfBijGZmWiJHRU",
authDomain: "proofpe.firebaseapp.com",
projectId: "proofpe",
storageBucket: "proofpe.firebasestorage.app",
messagingSenderId: "613475740070",
appId: "1:613475740070:web:dd5991095ee0c2e5cf4767"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.showSignup = () => {
loginDiv.classList.add("hidden");
signupDiv.classList.remove("hidden");
};

window.showLogin = () => {
signupDiv.classList.add("hidden");
loginDiv.classList.remove("hidden");
};

window.signup = async () => {
const name = signupName.value.trim();
const email = signupEmail.value.trim();
const pass = signupPassword.value.trim();

if(!name || !email || !pass){
alert("Please fill all fields");
return;
}

try{
await createUserWithEmailAndPassword(auth,email,pass);
alert("Account Created Successfully");
}catch(error){
if(error.code==="auth/email-already-in-use"){
alert("This email is already registered. Please login.");
}else{
alert("Signup failed. Check details.");
}
}
};

window.login = async () => {
const email = loginEmail.value.trim();
const pass = loginPassword.value.trim();

if(!email || !pass){
alert("Please enter email & password");
return;
}

try{
await signInWithEmailAndPassword(auth,email,pass);
}catch(error){
alert("Invalid email or password");
}
};

onAuthStateChanged(auth,user=>{
if(user){
loginDiv.classList.add("hidden");
signupDiv.classList.add("hidden");
dashboardDiv.classList.remove("hidden");
logoutBtn.classList.remove("hidden");
welcomeUser.innerText="Welcome, "+user.email;
loadDocs();
}else{
dashboardDiv.classList.add("hidden");
logoutBtn.classList.add("hidden");
loginDiv.classList.remove("hidden");
}
});

logoutBtn.onclick=()=>signOut(auth);

const CLOUD_NAME="ddfkdh1km";
const UPLOAD_PRESET="proofpe_unsigned";

window.uploadDoc = async () => {
const file=fileInput.files[0];
const type=docType.value;

if(!file){alert("Choose a file");return;}

const formData=new FormData();
formData.append("file",file);
formData.append("upload_preset",UPLOAD_PRESET);

const res=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`,{
method:"POST",
body:formData
});

const data=await res.json();

await addDoc(collection(db,"documents"),{
uid:auth.currentUser.uid,
type:type,
url:data.secure_url
});

alert("Uploaded Successfully");
fileInput.value="";
loadDocs();
};

async function loadDocs(){
docsList.innerHTML="";
const q=query(collection(db,"documents"),where("uid","==",auth.currentUser.uid));
const querySnapshot=await getDocs(q);

querySnapshot.forEach(docSnap=>{
const d=docSnap.data();

docsList.innerHTML+=`
<div class="doc-card">
<b>${d.type}</b>
<div class="doc-actions">
<button class="small-btn view-btn" onclick="window.open('${d.url}','_blank')">View</button>
<button class="small-btn delete-btn" onclick="deleteDocConfirm('${docSnap.id}')">Delete</button>
</div>
</div>`;
});
}

window.deleteDocConfirm=async(id)=>{
const pass=prompt("Enter your password to delete");
if(!pass)return;

try{
await signInWithEmailAndPassword(auth,auth.currentUser.email,pass);
await deleteDoc(doc(db,"documents",id));
alert("Deleted Successfully");
loadDocs();
}catch{
alert("Wrong password");
}
};

</script>
</body>
</html>
